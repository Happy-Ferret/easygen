// -*- go -*-
////////////////////////////////////////////////////////////////////////////
// Program: {{.Name}}
// Purpose: {{.Desc}}
////////////////////////////////////////////////////////////////////////////

package {{$.PackageName}}

import (
	"github.com/mkideal/cli"
)

////////////////////////////////////////////////////////////////////////////
// {{.Name}}

type rootT struct {
	cli.Helper{{range .Options}}
	{{.Name}}	{{.Type}}	`cli:"{{.Flag}}"usage:"{{.Usage}}"{{if eq .Name "Self" }} json:"-" parser:"jsonfile"{{end}}{{if .Value}} dft:"{{.Value}}"{{end}}`{{end}}
}

var root = &cli.Command{
	Name: "{{.Name}}",
	Desc: "{{.Desc}}",
{{if .Text}}	Text: "{{.Text}}",
{{end}}{{if .Global}}	Global: {{.Global}},
{{end}}{{if .Self}}	Argv: func() interface{} {  t := new(rootT); t.Self = t; return t },
{{else}}	Argv: func() interface{} { return new(rootT) },
{{end}}	Fn:   {{.Name}},
{{if .NumArg}}
	NumArg:      {{.NumArg}},
{{end}}}

// func main() {
// 	cli.SetUsageStyle(cli.ManualStyle) // up-down, for left-right, use NormalStyle
// 	//NOTE: You can set any writer implements io.Writer
// 	// default writer is os.Stdout
// 	if err := cli.Root(root,{{range $i, $opt := .Options}}{{if gt $i 0}}
// 		cli.Tree(t{{$opt.Name}}Cmd){{if lt $i ($.Options | len | minus1)}},{{end}}{{end}}{{end}}).Run(os.Args[1:]); err != nil {
// 		fmt.Fprintln(os.Stderr, err)
// 	}
// 	fmt.Println("")
// }

// func {{.Name}}(ctx *cli.Context) error {
// 	ctx.JSON(ctx.RootArgv())
// 	ctx.JSON(ctx.Argv())
// 	fmt.Println()

// 	return nil
// }

{{range .Command}}
////////////////////////////////////////////////////////////////////////////
// {{.Name}}

type {{.Name}}T struct {
{{range .Options}}
	{{.Name}}	{{.Type}}	`cli:"{{.Flag}}" usage:"{{.Usage}}"{{if eq .Name "Self" }} json:"-" parser:"jsonfile"{{end}}{{if .Value}} dft:"{{.Value}}"{{end}}`{{end}}
}

var {{.Name}}Cmd = &cli.Command{
	Name: "{{.Name}}",
	Desc: "{{.Desc}}",
{{if .Text}}	Text: "{{.Text}}",
{{end}}{{if .Self}}	Argv: func() interface{} {  t := new({{.Name}}T); t.Self = t; return t },
{{else}}	Argv: func() interface{} { return new({{.Name}}T) },
{{end}}	Fn:   {{.Name}},
{{if .NumArg}}
	NumArg:      {{.NumArg}},
	CanSubRoute: true,
{{end}}}

// func {{.Name}}(ctx *cli.Context) error {
// 	rootArgv := ctx.RootArgv().(*{{$.Var}}T)
// 	argv := ctx.Argv().(*{{.Name}}T)
// 	jR, _ := json.Marshal(*rootArgv)
// 	jC, _ := json.Marshal(*argv)
// 	ctx.String("[{{.Name}}]:\n  %v\n  %v\n  %v\n", string(jR), string(jC), ctx.Args())
// 	return nil
// }
{{end}}
